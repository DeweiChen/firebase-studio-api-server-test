<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .task-card {
            margin-bottom: 1rem;
        }
        .task-status {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
        .status-pending {
            background-color: #ffc107;
            color: #000;
        }
        .status-completed {
            background-color: #28a745;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Task Manager</h1>
        
        <!-- Create Task Form -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Create New Task</h5>
            </div>
            <div class="card-body">
                <form id="createTaskForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="status" class="form-label">Status</label>
                        <select class="form-select" id="status">
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Task</button>
                </form>
            </div>
        </div>

        <!-- Tasks List -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Tasks</h5>
            </div>
            <div class="card-body">
                <div id="tasksList"></div>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div class="modal fade" id="editTaskModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editTaskForm">
                        <input type="hidden" id="editTaskId">
                        <div class="mb-3">
                            <label for="editTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="editTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="editDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editStatus" class="form-label">Status</label>
                            <select class="form-select" id="editStatus">
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveEditTask">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE_URL = '.';

        // Load tasks on page load
        $(document).ready(function() {
            loadTasks();
        });

        // Create new task
        $('#createTaskForm').submit(function(e) {
            e.preventDefault();
            const task = {
                title: $('#title').val(),
                description: $('#description').val(),
                status: $('#status').val()
            };

            $.ajax({
                url: `${API_BASE_URL}/tasks`,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(task),
                success: function() {
                    loadTasks();
                    $('#createTaskForm')[0].reset();
                },
                error: function(xhr) {
                    alert('Error creating task: ' + xhr.responseJSON.error);
                }
            });
        });

        // Load all tasks
        function loadTasks() {
            $.ajax({
                url: `${API_BASE_URL}/tasks`,
                type: 'GET',
                success: function(tasks) {
                    const tasksList = $('#tasksList');
                    tasksList.empty();

                    tasks.forEach(task => {
                        const taskCard = $(`
                            <div class="card task-card">
                                <div class="card-body">
                                    <h5 class="card-title">${task.title}</h5>
                                    <p class="card-text">${task.description || ''}</p>
                                    <span class="task-status status-${task.status}">${task.status}</span>
                                    <div class="mt-2">
                                        <button class="btn btn-sm btn-primary edit-task" data-id="${task.id}">Edit</button>
                                        <button class="btn btn-sm btn-danger delete-task" data-id="${task.id}">Delete</button>
                                    </div>
                                </div>
                            </div>
                        `);
                        tasksList.append(taskCard);
                    });

                    // Add event listeners for edit and delete buttons
                    $('.edit-task').click(function() {
                        const taskId = $(this).data('id');
                        loadTaskForEdit(taskId);
                    });

                    $('.delete-task').click(function() {
                        const taskId = $(this).data('id');
                        deleteTask(taskId);
                    });
                },
                error: function(xhr) {
                    alert('Error loading tasks: ' + xhr.responseJSON.error);
                }
            });
        }

        // Load task for editing
        function loadTaskForEdit(taskId) {
            $.ajax({
                url: `${API_BASE_URL}/tasks/${taskId}`,
                type: 'GET',
                success: function(task) {
                    $('#editTaskId').val(task.id);
                    $('#editTitle').val(task.title);
                    $('#editDescription').val(task.description);
                    $('#editStatus').val(task.status);
                    $('#editTaskModal').modal('show');
                },
                error: function(xhr) {
                    alert('Error loading task: ' + xhr.responseJSON.error);
                }
            });
        }

        // Save edited task
        $('#saveEditTask').click(function() {
            const taskId = $('#editTaskId').val();
            const task = {
                title: $('#editTitle').val(),
                description: $('#editDescription').val(),
                status: $('#editStatus').val()
            };

            $.ajax({
                url: `${API_BASE_URL}/tasks/${taskId}`,
                type: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(task),
                success: function() {
                    $('#editTaskModal').modal('hide');
                    loadTasks();
                },
                error: function(xhr) {
                    alert('Error updating task: ' + xhr.responseJSON.error);
                }
            });
        });

        // Delete task
        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                $.ajax({
                    url: `${API_BASE_URL}/tasks/${taskId}`,
                    type: 'DELETE',
                    success: function() {
                        loadTasks();
                    },
                    error: function(xhr) {
                        alert('Error deleting task: ' + xhr.responseJSON.error);
                    }
                });
            }
        }
    </script>
</body>
</html> 